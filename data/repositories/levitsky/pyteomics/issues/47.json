{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/levitsky/pyteomics.json"}, "html": {"href": "#!/levitsky/pyteomics"}, "avatar": {"href": "data/bytebucket.org/ravatar/{3f6302de-10da-4d3c-b258-0bb6a2368972}ts=74456"}}, "type": "repository", "name": "pyteomics", "full_name": "levitsky/pyteomics", "uuid": "{3f6302de-10da-4d3c-b258-0bb6a2368972}"}, "links": {"attachments": {"href": "data/repositories/levitsky/pyteomics/issues/47/attachments_page=1.json"}, "self": {"href": "data/repositories/levitsky/pyteomics/issues/47.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/levitsky/pyteomics/issues/47/watch"}, "comments": {"href": "data/repositories/levitsky/pyteomics/issues/47/comments_page=1.json"}, "html": {"href": "#!/levitsky/pyteomics/issues/47/non-ascii-characters-in-auditcollection"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/levitsky/pyteomics/issues/47/vote"}}, "reporter": {"display_name": "Lutz Fischer", "uuid": "{7796ce7b-56d0-4b48-a5ee-2191230149f0}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B7796ce7b-56d0-4b48-a5ee-2191230149f0%7D"}, "html": {"href": "https://bitbucket.org/%7B7796ce7b-56d0-4b48-a5ee-2191230149f0%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/5bc9ac295b8ba5286cb9d07d/f3ad5bf8-4343-4b38-bed9-3202f68f080d/128"}}, "nickname": "Lutz", "type": "user", "account_id": "5bc9ac295b8ba5286cb9d07d"}, "title": "non-ascii characters in AuditCollection lead to UnicodeEncodeError", "component": null, "votes": 0, "watches": 2, "content": {"raw": "Non-ascii charaters \\(like german umlaut `\u00e4` in `AuditCollection`  causes:\r\n\r\n\u200c\r\n\r\n```\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py\", line 1194, in next\r\n    return self.__next__()\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py\", line 1191, in __next__\r\n    return next(self._iterator)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py\", line 571, in _iterfind_impl\r\n    info = self._get_info_smart(child, **kwargs)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/mzid.py\", line 142, in _get_info_smart\r\n    **kwargs)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py\", line 417, in _get_info\r\n    info[cname] = self._get_info_smart(child, ename=cname, **kwargs)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/mzid.py\", line 142, in _get_info_smart\r\n    **kwargs)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py\", line 413, in _get_info\r\n    newinfo = self._handle_param(child, **kwargs)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py\", line 362, in _handle_param\r\n    value = unitstr(value, unit_info)\r\n  File \"/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/auxiliary/structures.py\", line 222, in __new__\r\n    inst = super(unitstr, cls).__new__(cls, value)\r\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\xe4' in position 7: ordinal not in range(128)\r\n```\r\n\r\n\u200c\r\n\r\nchanging  `pyteomics/auxiliary/structures.py:222` from\r\n\r\n```\r\nclass unitstr(str):\r\n    def __new__(cls, value, unit_info=None):\r\n        inst = super(unitstr, cls).__new__(cls, value)\r\n        inst.unit_info = unit_info\r\n        return inst\r\n```\r\n\r\nto\r\n\r\n\u200c\r\n\r\n```python\r\nclass unitstr(str):\r\n    def __new__(cls, value, unit_info=None):\r\n        inst = super(unitstr, cls).__new__(cls, value.encode('utf-8'))\r\n        inst.unit_info = unit_info\r\n        return inst\r\n```\r\n\r\nSeem to fix this issue.", "markup": "markdown", "html": "<p>Non-ascii charaters (like german umlaut <code>\u00e4</code> in <code>AuditCollection</code>  causes:</p>\n<p>\u200c</p>\n<div class=\"codehilite\"><pre><span></span>  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py&quot;, line 1194, in next\n    return self.__next__()\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py&quot;, line 1191, in __next__\n    return next(self._iterator)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py&quot;, line 571, in _iterfind_impl\n    info = self._get_info_smart(child, **kwargs)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/mzid.py&quot;, line 142, in _get_info_smart\n    **kwargs)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py&quot;, line 417, in _get_info\n    info[cname] = self._get_info_smart(child, ename=cname, **kwargs)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/mzid.py&quot;, line 142, in _get_info_smart\n    **kwargs)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py&quot;, line 413, in _get_info\n    newinfo = self._handle_param(child, **kwargs)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/xml.py&quot;, line 362, in _handle_param\n    value = unitstr(value, unit_info)\n  File &quot;/home/lfischer/.local/share/virtualenvs/pymzid-hkwy9F4K/local/lib/python2.7/site-packages/pyteomics/auxiliary/structures.py&quot;, line 222, in __new__\n    inst = super(unitstr, cls).__new__(cls, value)\nUnicodeEncodeError: &#39;ascii&#39; codec can&#39;t encode character u&#39;\\xe4&#39; in position 7: ordinal not in range(128)\n</pre></div>\n\n\n<p>\u200c</p>\n<p>changing  <code>pyteomics/auxiliary/structures.py:222</code> from</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kr\">class</span> <span class=\"nx\">unitstr</span><span class=\"p\">(</span><span class=\"nx\">str</span><span class=\"p\">)</span><span class=\"o\">:</span>\n    <span class=\"nx\">def</span> <span class=\"nx\">__new__</span><span class=\"p\">(</span><span class=\"nx\">cls</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">,</span> <span class=\"nx\">unit_info</span><span class=\"o\">=</span><span class=\"nx\">None</span><span class=\"p\">)</span><span class=\"o\">:</span>\n        <span class=\"nx\">inst</span> <span class=\"o\">=</span> <span class=\"kr\">super</span><span class=\"p\">(</span><span class=\"nx\">unitstr</span><span class=\"p\">,</span> <span class=\"nx\">cls</span><span class=\"p\">).</span><span class=\"nx\">__new__</span><span class=\"p\">(</span><span class=\"nx\">cls</span><span class=\"p\">,</span> <span class=\"nx\">value</span><span class=\"p\">)</span>\n        <span class=\"nx\">inst</span><span class=\"p\">.</span><span class=\"nx\">unit_info</span> <span class=\"o\">=</span> <span class=\"nx\">unit_info</span>\n        <span class=\"k\">return</span> <span class=\"nx\">inst</span>\n</pre></div>\n\n\n<p>to</p>\n<p>\u200c</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">class</span> <span class=\"nc\">unitstr</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__new__</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">unit_info</span><span class=\"o\">=</span><span class=\"bp\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">inst</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">unitstr</span><span class=\"p\">,</span> <span class=\"bp\">cls</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"fm\">__new__</span><span class=\"p\">(</span><span class=\"bp\">cls</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s1\">&#39;utf-8&#39;</span><span class=\"p\">))</span>\n        <span class=\"n\">inst</span><span class=\"o\">.</span><span class=\"n\">unit_info</span> <span class=\"o\">=</span> <span class=\"n\">unit_info</span>\n        <span class=\"k\">return</span> <span class=\"n\">inst</span>\n</pre></div>\n\n\n<p>Seem to fix this issue.</p>", "type": "rendered"}, "assignee": null, "state": "resolved", "version": null, "edited_on": null, "created_on": "2019-10-22T08:22:16.441047+00:00", "milestone": null, "updated_on": "2019-11-30T19:49:21.022797+00:00", "type": "issue", "id": 47}