{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/levitsky/pyteomics.json"}, "html": {"href": "#!/levitsky/pyteomics"}, "avatar": {"href": "data/bytebucket.org/ravatar/{3f6302de-10da-4d3c-b258-0bb6a2368972}ts=74456"}}, "type": "repository", "name": "pyteomics", "full_name": "levitsky/pyteomics", "uuid": "{3f6302de-10da-4d3c-b258-0bb6a2368972}"}, "links": {"attachments": {"href": "data/repositories/levitsky/pyteomics/issues/22/attachments_page=1.json"}, "self": {"href": "data/repositories/levitsky/pyteomics/issues/22.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/levitsky/pyteomics/issues/22/watch"}, "comments": {"href": "data/repositories/levitsky/pyteomics/issues/22/comments_page=1.json"}, "html": {"href": "#!/levitsky/pyteomics/issues/22/isotopologues-kwargs-errors"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/levitsky/pyteomics/issues/22/vote"}}, "reporter": {"display_name": "jacobrosenstein", "uuid": "{15b69590-5316-43cf-92b2-426db558db61}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B15b69590-5316-43cf-92b2-426db558db61%7D"}, "html": {"href": "https://bitbucket.org/%7B15b69590-5316-43cf-92b2-426db558db61%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/d3c71a487a958950c1466398730b1f58d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsJ-4.png"}}, "nickname": "jacobrosenstein", "type": "user", "account_id": "5a9095b90e69ba52f30623f3"}, "title": "isotopologues kwargs errors", "component": null, "votes": 0, "watches": 1, "content": {"raw": "When I call mass.isotopologues with a 'composition' argument:\r\n\r\n\r\n```\r\n#!python\r\n\r\nmass.isotopologues(composition=composition,\r\n                                               report_abundance=True,\r\n                                               isotope_threshold=isotope_threshold,\r\n                                               overall_threshold=overall_threshold)\r\n```\r\n\r\n\r\n\r\nIt causes an error because it passes 2 'composition' kwargs to another function:\r\n\r\n\r\n```\r\n#!python\r\n\r\n/pyteomics/mass/mass.py\", line 715, in isotopologues\r\n   abundance = isotopic_composition_abundance(composition=ic, **kwargs)\r\nTypeError: isotopic_composition_abundance() got multiple values for keyword argument 'composition'\r\n```\r\n\r\n\r\nA similar error also happened with the 'formula' argument.\r\n\r\nThis may or may not be the best solution, but it can be fixed by removing 'composition' and 'formula' from kwargs before passing to isotopic_composition_abundance:\r\n\r\n```\r\n#!python\r\n\r\n    for isotopologue in product(*all_isotoplogues):\r\n        \r\n        if 'formula' in kwargs:\r\n            kwargs.pop('formula')\r\n\r\n        if 'composition' in kwargs:\r\n            kwargs.pop('composition')\r\n        \r\n        ic = Composition(formula=''.join(atom for el in isotopologue for atom in el), **kwargs)\r\n        if report_abundance or overall_threshold > 0.0:\r\n            abundance = isotopic_composition_abundance(composition=ic, **kwargs)\r\n\r\n```", "markup": "markdown", "html": "<p>When I call mass.isotopologues with a 'composition' argument:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">mass</span><span class=\"o\">.</span><span class=\"n\">isotopologues</span><span class=\"p\">(</span><span class=\"n\">composition</span><span class=\"o\">=</span><span class=\"n\">composition</span><span class=\"p\">,</span>\n                                               <span class=\"n\">report_abundance</span><span class=\"o\">=</span><span class=\"bp\">True</span><span class=\"p\">,</span>\n                                               <span class=\"n\">isotope_threshold</span><span class=\"o\">=</span><span class=\"n\">isotope_threshold</span><span class=\"p\">,</span>\n                                               <span class=\"n\">overall_threshold</span><span class=\"o\">=</span><span class=\"n\">overall_threshold</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>It causes an error because it passes 2 'composition' kwargs to another function:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"o\">/</span><span class=\"n\">pyteomics</span><span class=\"o\">/</span><span class=\"n\">mass</span><span class=\"o\">/</span><span class=\"n\">mass</span><span class=\"o\">.</span><span class=\"n\">py</span><span class=\"s2\">&quot;, line 715, in isotopologues</span>\n   <span class=\"n\">abundance</span> <span class=\"o\">=</span> <span class=\"n\">isotopic_composition_abundance</span><span class=\"p\">(</span><span class=\"n\">composition</span><span class=\"o\">=</span><span class=\"n\">ic</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"n\">isotopic_composition_abundance</span><span class=\"p\">()</span> <span class=\"n\">got</span> <span class=\"n\">multiple</span> <span class=\"n\">values</span> <span class=\"k\">for</span> <span class=\"n\">keyword</span> <span class=\"n\">argument</span> <span class=\"s1\">&#39;composition&#39;</span>\n</pre></div>\n\n\n<p>A similar error also happened with the 'formula' argument.</p>\n<p>This may or may not be the best solution, but it can be fixed by removing 'composition' and 'formula' from kwargs before passing to isotopic_composition_abundance:</p>\n<div class=\"codehilite language-python\"><pre><span></span>    <span class=\"k\">for</span> <span class=\"n\">isotopologue</span> <span class=\"ow\">in</span> <span class=\"n\">product</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">all_isotoplogues</span><span class=\"p\">):</span>\n\n        <span class=\"k\">if</span> <span class=\"s1\">&#39;formula&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s1\">&#39;formula&#39;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"s1\">&#39;composition&#39;</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s1\">&#39;composition&#39;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">ic</span> <span class=\"o\">=</span> <span class=\"n\">Composition</span><span class=\"p\">(</span><span class=\"n\">formula</span><span class=\"o\">=</span><span class=\"s1\">&#39;&#39;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">atom</span> <span class=\"k\">for</span> <span class=\"n\">el</span> <span class=\"ow\">in</span> <span class=\"n\">isotopologue</span> <span class=\"k\">for</span> <span class=\"n\">atom</span> <span class=\"ow\">in</span> <span class=\"n\">el</span><span class=\"p\">),</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">report_abundance</span> <span class=\"ow\">or</span> <span class=\"n\">overall_threshold</span> <span class=\"o\">&gt;</span> <span class=\"mf\">0.0</span><span class=\"p\">:</span>\n            <span class=\"n\">abundance</span> <span class=\"o\">=</span> <span class=\"n\">isotopic_composition_abundance</span><span class=\"p\">(</span><span class=\"n\">composition</span><span class=\"o\">=</span><span class=\"n\">ic</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n</pre></div>", "type": "rendered"}, "assignee": {"display_name": "Lev Levitsky", "uuid": "{eb44325f-4ee0-4e0b-a27c-f2ea23122a56}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beb44325f-4ee0-4e0b-a27c-f2ea23122a56%7D"}, "html": {"href": "https://bitbucket.org/%7Beb44325f-4ee0-4e0b-a27c-f2ea23122a56%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/a2593c44c42429c503d2e5e9e307e241d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLL-6.png"}}, "nickname": "levitsky", "type": "user", "account_id": "557058:986c547b-c50a-40b3-948a-29b4a93b7b30"}, "state": "resolved", "version": null, "edited_on": null, "created_on": "2018-02-23T22:32:04.711040+00:00", "milestone": null, "updated_on": "2018-03-08T22:19:42.928851+00:00", "type": "issue", "id": 22}