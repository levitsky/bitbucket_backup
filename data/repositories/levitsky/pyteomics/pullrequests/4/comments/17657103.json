{"links": {"self": {"href": "data/repositories/levitsky/pyteomics/pullrequests/4/comments/17657103.json"}, "html": {"href": "#!/levitsky/pyteomics/pull-requests/4/_/diff#comment-17657103"}}, "deleted": false, "pullrequest": {"type": "pullrequest", "id": 4, "links": {"self": {"href": "data/repositories/levitsky/pyteomics/pullrequests/4.json"}, "html": {"href": "#!/levitsky/pyteomics/pull-requests/4"}}, "title": "Added an IndexedMzML class to make random access of indexed MzML documents possible."}, "content": {"raw": "This looks very nice, but seems like the string-bytes problems are not gone yet.\nApparently the dict of offsets now has bytes for keys, and when you try to access an element using a string ID, there is a silent `KeyError` inside `get_by_id`, and then the element is found using `iterparse`.\n\nI noticed this because the mzid test currently fails on Python 3, unless you change this:\n\n```\n#!diff\n\ndiff -r 34d9bed90bd3 pyteomics/xml.py\n--- a/pyteomics/xml.py  Sat Apr 23 00:21:31 2016 -0400\n+++ b/pyteomics/xml.py  Sat Apr 23 19:25:02 2016 +0300\n@@ -643,7 +643,7 @@\n             lookup_id_key_mapping = {}\n \n         for name in self.indexed_tags:\n-            lookup_id_key_mapping.setdefault(name, \"id\")\n+            lookup_id_key_mapping.setdefault(name, b\"id\")\n         indices = defaultdict(OrderedDict)\n         g = self._generate_offsets()\n         for offset, offset_type, attrs in g:\n```\n\nSo apparently we want to decode the keys in `_offset_index`. If you are getting tired of this PR, which I can imagine, I think I can change it myself later and just accept it.\n\nOne other thing I'd like your input on: do you think it makes sense to have two separate sets of classes, or would it be better to merge them and introduce another boolean parameter or something like that?", "markup": "markdown", "html": "<p>This looks very nice, but seems like the string-bytes problems are not gone yet.\nApparently the dict of offsets now has bytes for keys, and when you try to access an element using a string ID, there is a silent <code>KeyError</code> inside <code>get_by_id</code>, and then the element is found using <code>iterparse</code>.</p>\n<p>I noticed this because the mzid test currently fails on Python 3, unless you change this:</p>\n<div class=\"codehilite language-diff\"><pre><span></span><span class=\"gh\">diff -r 34d9bed90bd3 pyteomics/xml.py</span>\n<span class=\"gd\">--- a/pyteomics/xml.py  Sat Apr 23 00:21:31 2016 -0400</span>\n<span class=\"gi\">+++ b/pyteomics/xml.py  Sat Apr 23 19:25:02 2016 +0300</span>\n<span class=\"gu\">@@ -643,7 +643,7 @@</span>\n             lookup_id_key_mapping = {}\n\n         for name in self.indexed_tags:\n<span class=\"gd\">-            lookup_id_key_mapping.setdefault(name, &quot;id&quot;)</span>\n<span class=\"gi\">+            lookup_id_key_mapping.setdefault(name, b&quot;id&quot;)</span>\n         indices = defaultdict(OrderedDict)\n         g = self._generate_offsets()\n         for offset, offset_type, attrs in g:\n</pre></div>\n\n\n<p>So apparently we want to decode the keys in <code>_offset_index</code>. If you are getting tired of this PR, which I can imagine, I think I can change it myself later and just accept it.</p>\n<p>One other thing I'd like your input on: do you think it makes sense to have two separate sets of classes, or would it be better to merge them and introduce another boolean parameter or something like that?</p>", "type": "rendered"}, "created_on": "2016-04-23T17:19:18.491783+00:00", "user": {"display_name": "Lev Levitsky", "uuid": "{eb44325f-4ee0-4e0b-a27c-f2ea23122a56}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beb44325f-4ee0-4e0b-a27c-f2ea23122a56%7D"}, "html": {"href": "https://bitbucket.org/%7Beb44325f-4ee0-4e0b-a27c-f2ea23122a56%7D/"}, "avatar": {"href": "data/secure.gravatar.com/avatar/a2593c44c42429c503d2e5e9e307e241d=httpsavatar-management--avatars.us-west-2.prod.public.atl-paas.netinitialsLL-6.png"}}, "nickname": "levitsky", "type": "user", "account_id": "557058:986c547b-c50a-40b3-948a-29b4a93b7b30"}, "updated_on": "2016-04-23T17:19:29.183255+00:00", "type": "pullrequest_comment", "id": 17657103}